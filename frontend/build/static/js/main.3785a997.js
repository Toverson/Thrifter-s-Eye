/*! For license information please see main.3785a997.js.LICENSE.txt */
(()=>{"use strict";var e={4:(e,t,n)=>{var r=n(853),i=n(43),s=n(950);function o(e){var t="https://d18a3045-2c1c-40aa-8394-0c6e9ccb961a.preview.emergentagent.com";class cy{static async saveScan(e){try{const t=Yg.currentUser;if(console.log("\ud83d\udd04 ScanService: saveScan called"),console.log("\ud83d\udd04 ScanService: Current user:",t?t.uid:"No user"),!t)throw new Error("User not authenticated");const n={...e,userId:t.uid,timestamp:Gg()};console.log("\ud83d\udd04 ScanService: Preparing to save scan with userId:",t.uid),console.log("\ud83d\udd04 ScanService: Scan data keys:",Object.keys(n));const r=await function(e,t){const n=Ya(e.firestore,Hm),r=Vm(e),i=Mg(e.converter,t);return Wg(n,[sg(ig(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,dh.exists(!1))]).then(()=>r)}(Um(Jg,"scans"),n);return console.log("\u2705 ScanService: Scan saved successfully with ID:",r.id),r.id}catch(t){throw console.error("\u274c ScanService: Error saving scan:",t),console.error("\u274c ScanService: Error details:",{code:t.code,message:t.message,stack:t.stack}),t}}static async getUserScans(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;try{const n=Yg.currentUser;if(console.log("\ud83d\udd04 ScanService: getUserScans called"),console.log("\ud83d\udd04 ScanService: Current user:",n?n.uid:"No user"),console.log("\ud83d\udd04 ScanService: Full user object:",n),!n)throw new Error("User not authenticated");console.log("\ud83d\udd04 ScanService: Querying scans for userId:",n.uid),console.log("\ud83d\udd04 ScanService: Auth state:",{isAnonymous:n.isAnonymous,uid:n.uid,email:n.email}),console.log("\ud83d\udd0d DEBUG: Fetching ALL scans to debug...");const r=Cg(Um(Jg,"scans")),i=await Hg(r);console.log("\ud83d\udd0d DEBUG: Total scans in database:",i.docs.length),i.docs.forEach(e=>{const t=e.data();console.log("\ud83d\udd0d DEBUG: Found scan:",{id:e.id,userId:t.userId,timestamp:t.timestamp,itemName:t.itemName||"No name"})});const s=Cg(Um(Jg,"scans"),function(e,t,n){const r=t,i=_g("where",e);return Ig._create(i,r,n)}("userId","==",n.uid),function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=_g("orderBy",e);return Ag._create(n,t)}("timestamp","desc"),(Xa("limit",t=e),Rg._create("limit",t,"F")));console.log("\ud83d\udd04 ScanService: Executing user-specific query...");const o=await Hg(s);console.log("\ud83d\udd04 ScanService: User-specific query returned",o.docs.length,"documents");const a=o.docs.map(e=>{var t;const n=e.data();return console.log("\ud83d\udd04 ScanService: Processing user scan:",e.id,"- userId:",n.userId),{id:e.id,...n,timestamp:(null===(t=n.timestamp)||void 0===t?void 0:t.toDate())||new Date}});return console.log("\u2705 ScanService: Processed",a.length,"user scans successfully"),a}catch(n){return console.error("\u274c ScanService: Error getting user scans:",n),console.error("\u274c ScanService: Error details:",{code:n.code,message:n.message,stack:n.stack,name:n.name}),"permission-denied"===n.code&&console.error("\u274c ScanService: Permission denied - check Firestore security rules"),[]}var t}static async getScanById(e){try{const n=await zg(Vm(Jg,"scans",e));var t;return n.exists()?{id:n.id,...n.data(),timestamp:(null===(t=n.data().timestamp)||void 0===t?void 0:t.toDate())||new Date}:null}catch(n){return console.error("Error getting scan by ID:",n),null}}}function uy(){const e=re(),t=ee(),{theme:n}=iy(),{imageBase64:i,imagePreview:s,location:o}=t.state||{},[a,l]=(0,r.useState)("Identifying object..."),c=["Identifying object...","Searching marketplaces...","Analyzing value...","Finalizing appraisal..."];(0,r.useEffect)(()=>{i?u():e("/camera")},[i,e]),(0,r.useEffect)(()=>{let e=0;const t=setInterval(()=>{e<c.length-1&&(e++,l(c[e]))},2e3);return()=>clearInterval(t)},[]);const u=async()=>{try{const t=Yg.currentUser;if(!t)return void e("/login");console.log("\ud83d\udd04 LoadingScreen: Starting image processing"),console.log("\ud83d\udccd LoadingScreen: User ID:",t.uid),console.log("\ud83d\udccd LoadingScreen: Location:",o),console.log("\ud83d\udd04 LoadingScreen: Calling CloudFunctionService");const n=await ly.scanItem(i,(null===o||void 0===o?void 0:o.countryCode)||"US",(null===o||void 0===o?void 0:o.currencyCode)||"USD");console.log("\u2705 LoadingScreen: CloudFunctionService completed"),console.log("\ud83d\udd04 LoadingScreen: Getting user data");const r=await Zg.getUserData(t.uid);r&&!r.isProSubscriber&&(console.log("\ud83d\udd04 LoadingScreen: Incrementing scan count"),await Zg.incrementScanCount(t.uid)),console.log("\ud83d\udd04 LoadingScreen: Preparing scan data");const a={...n,imageBase64:i,countryCode:(null===o||void 0===o?void 0:o.countryCode)||"US",currencyCode:(null===o||void 0===o?void 0:o.currencyCode)||"USD"};console.log("\ud83d\udd04 LoadingScreen: Saving scan to Firestore");const l=await cy.saveScan(a);console.log("\u2705 LoadingScreen: Scan saved with ID:",l),console.log("\ud83d\udd04 LoadingScreen: Navigating to results"),e("/results",{state:{scanResult:{...a,id:l},imagePreview:s}})}catch(t){console.error("\u274c LoadingScreen: Processing error:",t);let n="Failed to analyze image. Please try again.";t.message.includes("timeout")||t.message.includes("timed out")?n="Request timed out. Please check your internet connection and try again.":t.message.includes("Network")||t.message.includes("Failed to fetch")?n="Network error. Please check your internet connection and try again.":t.message.includes("500")&&(n="Server error. Please try again in a moment."),alert(n),e("/camera")}};return(0,ey.jsx)("div",{className:`min-h-screen ${n.colors.gradient} flex items-center justify-center p-4`,children:(0,ey.jsxs)("div",{className:"text-center",children:[s&&(0,ey.jsx)("div",{className:"mb-8",children:(0,ey.jsx)("img",{src:s,alt:"Processing item",className:"w-48 h-48 object-cover rounded-lg border-4 border-white shadow-lg mx-auto"})}),(0,ey.jsxs)("div",{className:"mb-8",children:[(0,ey.jsx)("div",{className:"animate-spin w-16 h-16 border-4 border-white border-t-transparent rounded-full mx-auto mb-6"}),(0,ey.jsx)("h2",{className:"text-3xl font-bold text-white mb-4",children:"Analyzing Item..."}),(0,ey.jsx)("p",{className:"text-xl text-blue-100",children:a})]}),(0,ey.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,ey.jsx)("div",{className:"w-full bg-white bg-opacity-30 rounded-full h-2 mb-4",children:(0,ey.jsx)("div",{className:"bg-white h-2 rounded-full transition-all duration-1000",style:{width:"70%"}})}),(0,ey.jsx)("p",{className:"text-blue-100 text-sm",children:"This may take 10-30 seconds"})]})]})})}function hy(){var e;const t=re(),n=ee(),{theme:i}=iy(),{scanResult:s,imagePreview:o}=n.state||{},[a,l]=(0,r.useState)(!1);if(!s)return(0,ey.jsx)("div",{className:`min-h-screen ${i.colors.backgroundSecondary} flex items-center justify-center`,children:(0,ey.jsxs)("div",{className:"text-center",children:[(0,ey.jsx)("div",{className:"text-6xl mb-4",children:"\u274c"}),(0,ey.jsx)("h2",{className:`text-2xl font-bold ${i.colors.text} mb-4`,children:"No Results Found"}),(0,ey.jsx)("p",{className:`${i.colors.textSecondary} mb-6`,children:"Something went wrong. Please try scanning again."}),(0,ey.jsx)("button",{onClick:()=>t("/camera"),className:`${i.colors.primary} ${i.colors.primaryText} font-bold py-3 px-6 rounded-full transition-colors`,children:"\ud83d\udcf8 Scan Again"})]})});const c=s.confidenceScore>=70?"text-green-600":s.confidenceScore>=40?"text-yellow-600":"text-red-600",u=s.confidenceScore>=70?"High Confidence":s.confidenceScore>=40?"Medium Confidence":"Low Confidence";return(0,ey.jsxs)("div",{className:`min-h-screen ${i.colors.backgroundSecondary}`,children:[(0,ey.jsx)("div",{className:`${i.colors.surface} shadow-sm ${i.colors.border} border-b`,children:(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-4 flex items-center",children:[(0,ey.jsx)("button",{onClick:()=>t("/"),className:"text-purple-600 hover:text-purple-800 font-semibold",children:"\u2190 Back to Home"}),(0,ey.jsx)("h1",{className:`flex-1 text-center text-xl font-bold ${i.colors.text}`,children:"Scan Results"}),(0,ey.jsx)("div",{className:"w-20"})]})}),(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,ey.jsx)("div",{className:`${i.colors.surface} rounded-lg shadow-lg overflow-hidden mb-8 ${i.colors.border} border`,children:(0,ey.jsxs)("div",{className:"md:flex",children:[(0,ey.jsx)("div",{className:"md:w-1/2",children:o&&(0,ey.jsx)("img",{src:o,alt:s.itemName,className:"w-full h-80 md:h-full object-cover"})}),(0,ey.jsxs)("div",{className:"md:w-1/2 p-6",children:[(0,ey.jsx)("h2",{className:`text-3xl font-bold ${i.colors.text} mb-4`,children:s.itemName||"Unknown Item"}),(0,ey.jsxs)("div",{className:"mb-6",children:[(0,ey.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,ey.jsx)("span",{className:`text-lg ${i.colors.textSecondary}`,children:"Estimated Value:"}),(0,ey.jsx)("span",{className:"text-2xl font-bold text-green-600",children:s.estimatedValue||"Value unknown"})]}),(0,ey.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ey.jsx)("span",{className:`text-sm ${i.colors.textSecondary}`,children:"Confidence:"}),(0,ey.jsxs)("span",{className:`text-sm font-semibold ${c}`,children:[s.confidenceScore||0,"% - ",u]})]})]}),(0,ey.jsxs)("div",{className:"space-y-3",children:[(0,ey.jsx)("button",{onClick:()=>t("/camera"),className:`w-full ${i.colors.primary} ${i.colors.primaryText} font-bold py-3 px-6 rounded-lg transition-colors`,children:"\ud83d\udcf8 Scan Another Item"}),(0,ey.jsx)("button",{onClick:()=>t("/history"),className:`w-full ${i.colors.secondary} ${i.colors.secondaryText} font-bold py-3 px-6 rounded-lg transition-colors`,children:"\ud83d\udcf1 View All Scans"})]})]})]})}),(0,ey.jsxs)("div",{className:`${i.colors.surface} rounded-lg shadow-lg p-6 mb-8 ${i.colors.border} border`,children:[(0,ey.jsx)("h3",{className:`text-xl font-bold ${i.colors.text} mb-4`,children:"AI Analysis"}),(0,ey.jsxs)("div",{className:`${i.colors.backgroundTertiary} rounded-lg p-4`,children:[(0,ey.jsx)("p",{className:`${i.colors.textSecondary} leading-relaxed`,children:a?s.aiAnalysis||"No detailed analysis available.":(null===(e=s.aiAnalysis)||void 0===e?void 0:e.substring(0,200))+"..."||0}),s.aiAnalysis&&s.aiAnalysis.length>200&&(0,ey.jsx)("button",{onClick:()=>l(!a),className:"text-purple-600 hover:text-purple-800 font-medium mt-2 text-sm",children:a?"Show Less":"Read More"})]})]}),s.listingDraft&&(0,ey.jsxs)("div",{className:`${i.colors.surface} rounded-lg shadow-lg p-6 mb-8 ${i.colors.border} border`,children:[(0,ey.jsx)("h3",{className:`text-xl font-bold ${i.colors.text} mb-4`,children:"\ud83d\udcdd Suggested Listing"}),(0,ey.jsxs)("div",{className:`${i.colors.backgroundTertiary} rounded-lg p-4`,children:[(0,ey.jsx)("h4",{className:`font-semibold ${i.colors.text} mb-2`,children:"Title:"}),(0,ey.jsx)("p",{className:`${i.colors.textSecondary} mb-4`,children:s.listingDraft.title||"No title available"}),(0,ey.jsx)("h4",{className:`font-semibold ${i.colors.text} mb-2`,children:"Description:"}),(0,ey.jsx)("p",{className:`${i.colors.textSecondary} text-sm leading-relaxed`,children:s.listingDraft.description||"No description available"})]})]}),s.similarListings&&s.similarListings.length>0&&(0,ey.jsxs)("div",{className:`${i.colors.surface} rounded-lg shadow-lg p-6 ${i.colors.border} border`,children:[(0,ey.jsx)("h3",{className:`text-xl font-bold ${i.colors.text} mb-4`,children:"\ud83d\uded2 Similar Marketplace Listings"}),(0,ey.jsx)("div",{className:"space-y-4",children:s.similarListings.slice(0,5).map((e,t)=>(0,ey.jsxs)("div",{className:`${i.colors.backgroundTertiary} rounded-lg p-4`,children:[(0,ey.jsx)("h4",{className:`font-semibold ${i.colors.text} mb-1 text-sm`,children:e.title||"Untitled Listing"}),(0,ey.jsx)("p",{className:`${i.colors.textSecondary} text-xs mb-2`,children:e.snippet||"No description available"}),e.link&&(0,ey.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:text-purple-800 text-xs font-medium",children:"View Listing \u2192"})]},t))})]})]})]})}function dy(){const e=re(),{theme:t}=iy(),[n,i]=(0,r.useState)([]),[s,o]=(0,r.useState)(!0),[a,l]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=_s(Yg,e=>{console.log("\ud83d\udd04 HistoryScreen: Auth state changed:",e?e.uid:"No user"),l(e),e?c(e):(o(!1),i([]))});return()=>e()},[]);const c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;try{if(o(!0),console.log("\ud83d\udd04 HistoryScreen: Loading scans for user:",null===e||void 0===e?void 0:e.uid),!e)return console.log("\u274c HistoryScreen: No authenticated user found"),void i([]);const t=await cy.getUserScans(10);console.log("\u2705 HistoryScreen: Loaded",t.length,"scans"),i(t)}catch(t){console.error("\u274c HistoryScreen: Error loading scans:",t),i([])}finally{o(!1)}},u=e=>{if(!e)return"Unknown date";return(e instanceof Date?e:new Date(e)).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})};return(0,ey.jsxs)("div",{className:`min-h-screen ${t.colors.backgroundSecondary}`,children:[(0,ey.jsx)("div",{className:`${t.colors.surface} shadow-sm ${t.colors.border} border-b`,children:(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-4 flex items-center",children:[(0,ey.jsx)("button",{onClick:()=>e("/"),className:"text-purple-600 hover:text-purple-800 font-semibold",children:"\u2190 Back to Home"}),(0,ey.jsx)("h1",{className:`flex-1 text-center text-xl font-bold ${t.colors.text}`,children:"Scan History"}),(0,ey.jsx)("div",{className:"w-20"})," "]})}),(0,ey.jsx)("div",{className:"container mx-auto px-4 py-8",children:s?(0,ey.jsxs)("div",{className:"text-center py-16",children:[(0,ey.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-purple-600 border-t-transparent rounded-full mx-auto mb-4"}),(0,ey.jsx)("p",{className:t.colors.textSecondary,children:"Loading your scan history..."})]}):0===n.length?(0,ey.jsxs)("div",{className:"text-center py-16",children:[(0,ey.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udccb"}),(0,ey.jsx)("h3",{className:`text-2xl font-bold ${t.colors.text} mb-4`,children:"No scans yet"}),(0,ey.jsx)("p",{className:`${t.colors.textSecondary} mb-8 max-w-md mx-auto`,children:"Start by scanning your first item to see your history here!"}),(0,ey.jsx)("button",{onClick:()=>e("/"),className:`${t.colors.primary} ${t.colors.primaryText} font-bold py-3 px-8 rounded-full transition-colors`,children:"\ud83d\udcf8 Scan Your First Item"})]}):(0,ey.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,ey.jsx)("div",{className:"grid gap-4",children:n.map(n=>(0,ey.jsx)("div",{onClick:()=>(t=>{e("/results",{state:{scanResult:t,imagePreview:`data:image/jpeg;base64,${t.imageBase64}`}})})(n),className:`${t.colors.surface} rounded-lg shadow-md p-4 cursor-pointer ${t.colors.cardHover} transition-shadow ${t.colors.border} border`,children:(0,ey.jsxs)("div",{className:"flex items-center",children:[(0,ey.jsx)("img",{src:`data:image/jpeg;base64,${n.imageBase64}`,alt:n.itemName,className:"w-16 h-16 object-cover rounded-lg mr-4"}),(0,ey.jsxs)("div",{className:"flex-1",children:[(0,ey.jsx)("h3",{className:`font-bold ${t.colors.text} text-lg`,children:n.itemName||"Unknown Item"}),(0,ey.jsx)("p",{className:"text-green-600 font-semibold",children:n.estimatedValue||"Value unknown"}),(0,ey.jsx)("p",{className:`${t.colors.textMuted} text-sm`,children:u(n.timestamp)})]}),(0,ey.jsx)("div",{className:`${t.colors.textMuted} text-xl`,children:"\u2192"})]})},n.id))}),(0,ey.jsx)("div",{className:"text-center mt-8",children:(0,ey.jsx)("button",{onClick:c,className:"text-purple-600 hover:text-purple-800 font-semibold",children:"\ud83d\udd04 Refresh"})})]})})]})}function fy(){const e=re(),{theme:t}=iy();return(0,ey.jsxs)("div",{className:`min-h-screen ${t.colors.backgroundSecondary}`,children:[(0,ey.jsx)("div",{className:`${t.colors.surface} shadow-sm ${t.colors.border} border-b`,children:(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-4 flex items-center",children:[(0,ey.jsx)("button",{onClick:()=>e("/"),className:"text-purple-600 hover:text-purple-800 font-semibold",children:"\u2190 Back to Home"}),(0,ey.jsx)("h1",{className:`flex-1 text-center text-xl font-bold ${t.colors.text}`,children:"Upgrade to Pro"}),(0,ey.jsx)("div",{className:"w-20"})]})}),(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[(0,ey.jsxs)("div",{className:"text-center mb-12",children:[(0,ey.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udc8e"}),(0,ey.jsx)("h2",{className:`text-4xl font-bold ${t.colors.text} mb-4`,children:"Unlock Pro Features"}),(0,ey.jsx)("p",{className:`text-xl ${t.colors.textSecondary} mb-8`,children:"You've used all 5 free scans. Upgrade to Pro for unlimited access and premium features."})]}),(0,ey.jsxs)("div",{className:`${t.colors.surface} rounded-lg shadow-xl p-8 mb-8 ${t.colors.border} border`,children:[(0,ey.jsxs)("div",{className:"text-center mb-8",children:[(0,ey.jsx)("h3",{className:`text-2xl font-bold ${t.colors.text} mb-2`,children:"Thrifter's Eye Pro"}),(0,ey.jsxs)("div",{className:"flex items-baseline justify-center",children:[(0,ey.jsx)("span",{className:"text-4xl font-bold text-green-600",children:"$4.99"}),(0,ey.jsx)("span",{className:`text-lg ${t.colors.textSecondary} ml-2`,children:"/month"})]}),(0,ey.jsx)("p",{className:`text-sm ${t.colors.textMuted} mt-2`,children:"Cancel anytime"})]}),(0,ey.jsx)("div",{className:"space-y-4 mb-8",children:["\ud83d\udcf7 Unlimited item scans","\ud83d\udc8e Premium AI analysis","\ud83d\udcca Advanced market insights","\ud83c\udff7\ufe0f Detailed listing recommendations","\ud83d\udcc8 Price history tracking","\ud83d\udd04 Scan history backup"].map((e,n)=>(0,ey.jsxs)("div",{className:"flex items-center",children:[(0,ey.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3",children:(0,ey.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ey.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,ey.jsx)("span",{className:t.colors.text,children:e})]},n))}),(0,ey.jsx)("button",{onClick:async()=>{try{const t=Yg.currentUser;t&&(await Zg.updateProStatus(t.uid,!0),alert("Pro upgrade successful! (This is a web demo - in the real app, this would use RevenueCat)"),e("/"))}catch(t){console.error("Pro upgrade error:",t),alert("Failed to upgrade to Pro. Please try again.")}},className:`w-full ${t.colors.success} text-white font-bold py-4 px-8 rounded-lg text-lg transition-colors shadow-lg hover:shadow-xl`,children:"\ud83d\ude80 Upgrade to Pro Now"}),(0,ey.jsx)("p",{className:`text-xs ${t.colors.textMuted} text-center mt-4`,children:"In the actual iOS app, this would integrate with RevenueCat for subscription management"})]}),(0,ey.jsxs)("div",{className:`${t.colors.surface} rounded-lg p-6 ${t.colors.border} border`,children:[(0,ey.jsx)("h4",{className:`font-bold ${t.colors.text} mb-3`,children:"Why Upgrade?"}),(0,ey.jsxs)("div",{className:`space-y-2 text-sm ${t.colors.textSecondary}`,children:[(0,ey.jsxs)("p",{children:["\u2022 ",(0,ey.jsx)("strong",{children:"Save Money:"})," Find valuable items others miss"]}),(0,ey.jsxs)("p",{children:["\u2022 ",(0,ey.jsx)("strong",{children:"Make Money:"})," Price items correctly for maximum profit"]}),(0,ey.jsxs)("p",{children:["\u2022 ",(0,ey.jsx)("strong",{children:"Save Time:"})," Instant AI-powered identification and valuation"]}),(0,ey.jsxs)("p",{children:["\u2022 ",(0,ey.jsx)("strong",{children:"Stay Ahead:"})," Advanced market insights keep you competitive"]})]})]}),(0,ey.jsx)("div",{className:"text-center mt-8",children:(0,ey.jsx)("p",{className:`text-sm ${t.colors.textMuted}`,children:"Your free trial included 5 scans. Upgrade now to continue discovering hidden treasures!"})})]})]})}function py(){var e;const t=re(),{theme:n,toggleTheme:i,isDark:s}=iy(),[o,a]=(0,r.useState)(!1),[l]=(0,r.useState)(Yg.currentUser),c=null===l||void 0===l?void 0:l.isAnonymous;return(0,ey.jsxs)("div",{className:`min-h-screen ${n.colors.backgroundSecondary}`,children:[(0,ey.jsx)("div",{className:`${n.colors.surface} shadow-sm ${n.colors.border} border-b`,children:(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-4 flex items-center",children:[(0,ey.jsx)("button",{onClick:()=>t("/"),className:"text-purple-600 hover:text-purple-800 font-semibold",children:"\u2190 Back to Home"}),(0,ey.jsx)("h1",{className:`flex-1 text-center text-xl font-bold ${n.colors.text}`,children:"Settings"}),(0,ey.jsx)("div",{className:"w-20"})]})}),(0,ey.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[(0,ey.jsxs)("div",{className:`${n.colors.surface} rounded-lg shadow-lg p-6 mb-6 border ${n.colors.border}`,children:[(0,ey.jsx)("h2",{className:`text-xl font-bold ${n.colors.text} mb-4`,children:"Appearance"}),(0,ey.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ey.jsxs)("div",{className:"flex items-center",children:[(0,ey.jsx)("span",{className:"text-2xl mr-3",children:s?"\ud83c\udf19":"\u2600\ufe0f"}),(0,ey.jsxs)("div",{children:[(0,ey.jsx)("h3",{className:`font-semibold ${n.colors.text}`,children:s?"Dark Mode":"Light Mode"}),(0,ey.jsx)("p",{className:`${n.colors.textSecondary} text-sm`,children:"Choose your preferred theme"})]})]}),(0,ey.jsx)("button",{onClick:i,className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s?"bg-purple-600":"bg-gray-300"),children:(0,ey.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s?"translate-x-6":"translate-x-1")})})]})]}),(0,ey.jsxs)("div",{className:`${n.colors.surface} rounded-lg shadow-lg p-6 mb-6 border ${n.colors.border}`,children:[(0,ey.jsx)("h2",{className:`text-xl font-bold ${n.colors.text} mb-4`,children:"Account Status"}),(0,ey.jsxs)("div",{className:`${n.colors.backgroundTertiary} rounded-lg p-4`,children:[(0,ey.jsxs)("div",{className:"flex items-center mb-2",children:[(0,ey.jsx)("span",{className:"text-2xl mr-3",children:c?"\ud83d\udc64":"\ud83d\udd10"}),(0,ey.jsxs)("div",{children:[(0,ey.jsx)("h3",{className:`font-semibold ${n.colors.text}`,children:c?"Anonymous Account":"Permanent Account"}),(0,ey.jsx)("p",{className:`${n.colors.textSecondary} text-sm`,children:c?"Your data is saved locally but not backed up.":"Your account is protected and backed up."})]})]}),(0,ey.jsxs)("p",{className:`text-xs ${n.colors.textMuted} font-mono mt-2`,children:["User ID: ",null===l||void 0===l||null===(e=l.uid)||void 0===e?void 0:e.substr(0,8),"..."]})]})]}),c&&(0,ey.jsxs)("div",{className:`${n.colors.surface} rounded-lg shadow-lg p-6 mb-6 border ${n.colors.border}`,children:[(0,ey.jsx)("h2",{className:`text-xl font-bold ${n.colors.text} mb-4`,children:"Protect Your Scans"}),(0,ey.jsx)("p",{className:`${n.colors.textSecondary} mb-6`,children:"Create a permanent account to protect your scan history and subscription across devices."}),(0,ey.jsxs)("div",{className:"space-y-3",children:[(0,ey.jsx)("button",{onClick:async()=>{const e=prompt("Enter your email:");if(!e)return;const t=prompt("Enter a password:");if(t)try{a(!0);const n=is.credential(e,t);await Es(l,n),alert("Account linked successfully! Your anonymous account has been upgraded to a permanent account.")}catch(n){console.error("Account linking error:",n),alert("Failed to link account. Please try again.")}finally{a(!1)}},disabled:o,className:`w-full ${n.colors.primary} ${n.colors.primaryText} font-bold py-3 px-6 rounded-lg transition-colors disabled:opacity-50`,children:"\ud83d\udce7 Link with Email & Password"}),(0,ey.jsx)("button",{onClick:async()=>{try{a(!0);const e=await async function(e,t,n){if(tr(e.app))return Promise.reject(kr(e,"operation-not-supported-in-this-environment"));const r=Di(e);Cr(e,t,ss);const i=eo(r,n);return new ao(r,"signInViaPopup",t,i).executeNotNull()}(Yg,Xg),t=e.credential;t&&(await Es(l,t),alert("Google account linked successfully! Your anonymous account has been upgraded."))}catch(e){console.error("Google linking error:",e),alert("Failed to link Google account. Please try again.")}finally{a(!1)}},disabled:o,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors disabled:opacity-50",children:"\ud83d\udd17 Link with Google"})]})]}),(0,ey.jsxs)("div",{className:`${n.colors.surface} rounded-lg shadow-lg p-6 mb-6 border ${n.colors.border}`,children:[(0,ey.jsx)("h2",{className:`text-xl font-bold ${n.colors.text} mb-4`,children:"Subscription"}),(0,ey.jsxs)("div",{className:"space-y-3",children:[(0,ey.jsx)("button",{onClick:()=>{alert("Manage Subscriptions\n\nIn the iOS app, this would open your device's subscription management screen.\n\nOn iOS: Settings \u2192 Apple ID \u2192 Subscriptions \u2192 Thrifter's Eye\n\nThis allows you to cancel, modify, or view your subscription details.")},disabled:o,className:`w-full ${n.colors.primary} ${n.colors.primaryText} font-bold py-3 px-6 rounded-lg transition-colors disabled:opacity-50`,children:"\u2699\ufe0f Manage Subscription"}),(0,ey.jsx)("button",{onClick:async()=>{try{a(!0),await Zg.updateProStatus(l.uid,!0),alert("Purchases restored! (This is a web demo - in the real app, this would use RevenueCat)")}catch(e){console.error("Restore error:",e),alert("Failed to restore purchases.")}finally{a(!1)}},disabled:o,className:`w-full ${n.colors.success} text-white font-bold py-3 px-6 rounded-lg transition-colors disabled:opacity-50`,children:"\ud83d\udd04 Restore Purchases (Demo)"})]}),(0,ey.jsxs)("p",{className:`${n.colors.textSecondary} text-sm mt-4`,children:[(0,ey.jsx)("strong",{children:"iOS App Behavior:"}),(0,ey.jsx)("br",{}),'\u2022 "Manage Subscription" opens your device\'s Apple ID subscription management',(0,ey.jsx)("br",{}),'\u2022 "Restore Purchases" syncs your subscription status with RevenueCat']})]}),(0,ey.jsxs)("div",{className:`${s?"bg-blue-900":"bg-blue-50"} ${s?"border-blue-700":"border-blue-200"} border rounded-lg p-6 mb-6`,children:[(0,ey.jsx)("h2",{className:`text-lg font-bold ${s?"text-blue-300":"text-blue-800"} mb-3`,children:"Web Testing Mode"}),(0,ey.jsxs)("div",{className:"space-y-2 text-sm "+(s?"text-blue-200":"text-blue-700"),children:[(0,ey.jsx)("p",{children:"\u2022 Anonymous authentication is working correctly"}),(0,ey.jsx)("p",{children:"\u2022 All Firestore operations use your anonymous user ID"}),(0,ey.jsx)("p",{children:"\u2022 Account linking simulates the iOS app flow"}),(0,ey.jsx)("p",{children:"\u2022 RevenueCat features are simulated for web testing"}),(0,ey.jsx)("p",{children:"\u2022 Theme switching persists across sessions"})]})]}),(0,ey.jsxs)("div",{className:`${n.colors.surface} rounded-lg shadow-lg p-6 border ${n.colors.border}`,children:[(0,ey.jsx)("h2",{className:`text-xl font-bold ${n.colors.text} mb-4`,children:"App Information"}),(0,ey.jsxs)("div",{className:`${n.colors.textSecondary} space-y-1`,children:[(0,ey.jsx)("p",{children:"Thrifter's Eye v1.0"}),(0,ey.jsx)("p",{children:"AI-powered item identification"}),(0,ey.jsx)("p",{children:"Web testing version mirroring iOS app"}),(0,ey.jsxs)("p",{children:["Theme: ",s?"Dark Mode":"Light Mode"]})]})]})]})]})}const my=e=>{let{retryAuth:t}=e;const{theme:n}=iy();return(0,ey.jsx)("div",{className:`min-h-screen ${n.colors.gradient} flex items-center justify-center`,children:(0,ey.jsxs)("div",{className:"text-center",children:[(0,ey.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udd12"}),(0,ey.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Authentication Required"}),(0,ey.jsx)("p",{className:"text-blue-100 mb-6",children:"Unable to create anonymous session"}),(0,ey.jsx)("button",{onClick:t,className:"bg-white hover:bg-gray-100 text-purple-600 font-bold py-3 px-6 rounded-full transition-colors",children:"Try Again"})]})})},gy=()=>{const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(!0),[s,o]=(0,r.useState)(null),[a,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)({step:"Initializing",timestamp:Date.now()});(0,r.useEffect)(()=>{let e,r=!0;console.log("\ud83d\udd27 Auth useEffect starting..."),u({step:"Setting up auth listener",timestamp:Date.now()});e=setTimeout(()=>{r&&n&&(console.error("\u274c Authentication timeout reached after 15 seconds"),o("Authentication timeout - please check your internet connection and try again"),i(!1),u({step:"Timeout reached",timestamp:Date.now()}))},15e3);const c=_s(Yg,async n=>{if(console.log("\ud83d\udd04 Auth state changed:",n?`User signed in: ${n.uid}`:"No user"),u({step:"Auth state changed",user:n?n.uid:"none",timestamp:Date.now()}),e&&clearTimeout(e),n){console.log("\u2705 User details:",{uid:n.uid,isAnonymous:n.isAnonymous,email:n.email}),u({step:"Creating user document",userId:n.uid,timestamp:Date.now()});try{console.log("\ud83d\udcdd Creating user document for:",n.uid),await Zg.createUserIfNotExists(n.uid,n.email||"anonymous@thrifterseye.com"),console.log("\u2705 User document created/verified"),r&&(t(n),o(null),i(!1),u({step:"Authentication complete",userId:n.uid,timestamp:Date.now()}))}catch(s){console.error("\u274c Error creating user document:",s),r&&(o(`Failed to initialize user data: ${s.message}`),i(!1),u({step:"User document creation failed",error:s.message,timestamp:Date.now()}))}}else if(a)console.log("\u26a0\ufe0f Authentication was attempted but no user found"),r&&(i(!1),u({step:"Authentication failed - no user",timestamp:Date.now()}));else{console.log("\ud83d\udd10 No user found, attempting anonymous sign-in..."),u({step:"Attempting anonymous sign-in",timestamp:Date.now()}),l(!0);try{console.log("\ud83d\ude80 Initiating anonymous sign-in...");const e=await ps(Yg);console.log("\u2705 Anonymous sign-in successful:",e.user.uid),u({step:"Anonymous sign-in successful",userId:e.user.uid,timestamp:Date.now()})}catch(s){console.error("\u274c Anonymous sign-in failed:",s),console.error("Error code:",s.code),console.error("Error message:",s.message),r&&(o(`Authentication failed: ${s.message}`),i(!1),u({step:"Anonymous sign-in failed",error:s.message,timestamp:Date.now()}))}}});return console.log("\ud83d\udd27 Firebase auth instance:",Yg),console.log("\ud83d\udd27 Firebase config:",Yg.app.options),()=>{console.log("\ud83e\uddf9 Cleaning up auth effect..."),r=!1,e&&clearTimeout(e),c()}},[a]);const h=async()=>{console.log("\ud83d\udd04 Retrying authentication..."),i(!0),o(null),l(!1),u({step:"Retrying authentication",timestamp:Date.now()});try{console.log("\ud83d\ude80 Retrying anonymous authentication...");const e=await ps(Yg);console.log("\u2705 Retry successful:",e.user.uid),u({step:"Retry successful",userId:e.user.uid,timestamp:Date.now()})}catch(s){console.error("\u274c Retry failed:",s),o(`Retry failed: ${s.message}`),i(!1),u({step:"Retry failed",error:s.message,timestamp:Date.now()})}};return n?(0,ey.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center",children:(0,ey.jsxs)("div",{className:"text-center",children:[(0,ey.jsx)("div",{className:"animate-spin w-16 h-16 border-4 border-white border-t-transparent rounded-full mx-auto mb-8"}),(0,ey.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Loading Thrifter's Eye..."}),(0,ey.jsx)("p",{className:"text-blue-100",children:"Setting up your anonymous session..."}),(0,ey.jsxs)("div",{className:"mt-8 bg-white bg-opacity-10 rounded-lg p-4 max-w-lg mx-auto text-left",children:[(0,ey.jsx)("h3",{className:"text-white font-semibold mb-2",children:"Debug Information:"}),(0,ey.jsxs)("p",{className:"text-blue-100 text-sm mb-1",children:[(0,ey.jsx)("strong",{children:"Current Step:"})," ",c.step]}),(0,ey.jsxs)("p",{className:"text-blue-100 text-sm mb-1",children:[(0,ey.jsx)("strong",{children:"Auth Attempted:"})," ",a?"Yes":"No"]}),(0,ey.jsxs)("p",{className:"text-blue-100 text-sm mb-1",children:[(0,ey.jsx)("strong",{children:"Current User:"})," ",Yg.currentUser?`${Yg.currentUser.uid} (${Yg.currentUser.isAnonymous?"Anonymous":"Authenticated"})`:"None"]}),(0,ey.jsxs)("p",{className:"text-blue-100 text-sm mb-1",children:[(0,ey.jsx)("strong",{children:"Firebase Connected:"})," ",Yg.app?"Yes":"No"]}),(0,ey.jsxs)("p",{className:"text-blue-100 text-sm",children:[(0,ey.jsx)("strong",{children:"Timestamp:"})," ",new Date(c.timestamp).toLocaleTimeString()]}),c.userId&&(0,ey.jsxs)("p",{className:"text-blue-100 text-sm",children:[(0,ey.jsx)("strong",{children:"User ID:"})," ",c.userId.substring(0,8),"..."]})]}),(0,ey.jsx)("div",{className:"mt-6",children:(0,ey.jsx)("button",{onClick:h,className:"bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm",children:"Force Retry"})})]})}):s?(0,ey.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center",children:(0,ey.jsxs)("div",{className:"text-center max-w-md mx-auto px-4",children:[(0,ey.jsx)("div",{className:"text-6xl mb-6",children:"\u26a0\ufe0f"}),(0,ey.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Authentication Error"}),(0,ey.jsx)("div",{className:"bg-red-500 bg-opacity-20 border border-red-400 rounded-lg p-4 mb-6",children:(0,ey.jsx)("p",{className:"text-red-100 text-sm",children:s})}),(0,ey.jsx)("button",{onClick:h,className:"bg-white hover:bg-gray-100 text-purple-600 font-bold py-3 px-6 rounded-full transition-colors",children:"Retry Authentication"}),(0,ey.jsxs)("div",{className:"mt-6 bg-white bg-opacity-10 rounded-lg p-4",children:[(0,ey.jsx)("p",{className:"text-blue-100 text-xs mb-2",children:"If this persists, check that Anonymous authentication is enabled in Firebase Console:"}),(0,ey.jsx)("p",{className:"text-blue-100 text-xs mb-1",children:"1. Go to Firebase Console \u2192 Authentication \u2192 Sign-in method"}),(0,ey.jsx)("p",{className:"text-blue-100 text-xs mb-1",children:'2. Enable "Anonymous" provider'}),(0,ey.jsx)("p",{className:"text-blue-100 text-xs",children:"3. Make sure your Firebase project is active"}),c.error&&(0,ey.jsx)("div",{className:"mt-3 p-2 bg-red-500 bg-opacity-20 rounded",children:(0,ey.jsxs)("p",{className:"text-red-200 text-xs",children:[(0,ey.jsx)("strong",{children:"Error:"})," ",c.error]})})]})]})}):e?(0,ey.jsx)(rt,{children:(0,ey.jsxs)(_e,{children:[(0,ey.jsx)(Se,{path:"/",element:e?(0,ey.jsx)(oy,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"/camera",element:e?(0,ey.jsx)(ay,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"/loading",element:e?(0,ey.jsx)(uy,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"/results",element:e?(0,ey.jsx)(hy,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"/history",element:e?(0,ey.jsx)(dy,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"/paywall",element:e?(0,ey.jsx)(fy,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"/settings",element:e?(0,ey.jsx)(py,{}):(0,ey.jsx)(my,{retryAuth:h})}),(0,ey.jsx)(Se,{path:"*",element:(0,ey.jsx)(we,{to:"/",replace:!0})})]})}):(0,ey.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center",children:(0,ey.jsxs)("div",{className:"text-center",children:[(0,ey.jsx)("div",{className:"text-6xl mb-6",children:"\ud83d\udd12"}),(0,ey.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Authentication Required"}),(0,ey.jsx)("p",{className:"text-blue-100 mb-6",children:"Unable to create anonymous session"}),(0,ey.jsx)("button",{onClick:h,className:"bg-white hover:bg-gray-100 text-purple-600 font-bold py-3 px-6 rounded-full transition-colors",children:"Try Again"})]})})};const yy=function(){return(0,ey.jsx)(ry,{children:(0,ey.jsx)(gy,{})})};i.createRoot(document.getElementById("root")).render((0,ey.jsx)(r.StrictMode,{children:(0,ey.jsx)(yy,{})}))})();
//# sourceMappingURL=main.3785a997.js.map